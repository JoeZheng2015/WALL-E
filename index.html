<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>WALL-E</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }
        .Walle {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        .Walle__text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .Walle__rest {
            color: red;
        }
        .Walle__content {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            background: url(./images/wallpaper1.jpg) no-repeat;
            background-size: cover;
            transition: opacity 400ms;
            opacity: 1;
        }
        .Walle__content--hide {
            opacity: 0;
        }
    </style>
</head>
<body>
    <div class="Walle">
        <section class="Walle__text">
            只剩<span class="Walle__rest">100</span>天
        </section>
        <section class="Walle__content">
            
        </section>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', init)

        function init() {
            const BEGIN = 1489507200001
            const NUMBER_OF_DAY = 100
            const progress = getProgress(Date.now(), getDays(BEGIN, NUMBER_OF_DAY))
            setProgress(progress, NUMBER_OF_DAY)

            mountEvent()
        }

        function mountEvent() {
            const $Walle = document.querySelector('.Walle')
            const $wallpaper = document.querySelector('.Walle__content')

            $Walle.addEventListener('touchstart', toggleWallpaper)

            function toggleWallpaper() {
                $wallpaper.classList.toggle('Walle__content--hide')
            }
        }


        function getDays(begin, NUMBER_OF_DAY) {
            let result = []
            const beginDate = new Date(begin)
            let n = 0

            while(result.length < NUMBER_OF_DAY) {
                const date = new Date(begin).setDate(beginDate.getDate() + n)
                if (isWeekday(date)) {
                    result.push(date)
                }
                n++
            }

            return result
        }

        function isWeekday(date) {
            const day = new Date(date).getDay()

            return 0 < day && day < 6
        }

        function getProgress(now, days) {
            return days.findIndex(day => day > now)
        }

        function setProgress(progress, total) {
            const rest = total - progress
            const $rest = document.querySelector('.Walle__rest')

            $rest.textContent = rest
        }
    </script>
</body>
</html>